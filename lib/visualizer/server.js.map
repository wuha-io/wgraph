{"version":3,"sources":["../../src/visualizer/server.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;AAOA,IAAI,MAAM,GAAG,eAAK,YAAY,CAAC,CAAC,GAAG,EAAE,GAAG,KAAK;AAC3C,MAAI,SAAS,GAAG,GAAG,IAAI;AACrB,WAAO,CAAC,KAAK,CAAC,GAAG,CAAC,CAAA;AAClB,OAAG,CAAC,UAAU,GAAG,GAAG,CAAC;AACrB,OAAG,CAAC,GAAG,CAAC,GAAG,CAAC,OAAO,IAAI,GAAG,CAAC,CAAA;GAC5B,CAAC;AACF,MAAI,MAAM,GAAG,SAAS,CAAC,OAAO,CAAC,eAAK,GAAG,GAAG,KAAK,GAAG,eAAK,GAAG,EAAE,eAAK,GAAG,GAAG,KAAK,GAAG,eAAK,GAAG,CAAC,CAAA;AACxF,MAAI,SAAS,GAAG,MAAM,CAAC,aAAG,YAAY,CAAC,MAAM,GAAG,aAAa,CAAC,CAAC,CAAA;AAC/D,MAAI,KAAK,GAAG,cAAI,KAAK,CAAC,GAAG,CAAC,GAAG,EAAE,IAAI,CAAC,CAAC,KAAK,CAAA;AAC1C,MAAI,CAAC,KAAK,CAAC,KAAK,EAAE,OAAO,SAAS,CAAC,oCAAoC,CAAC,CAAA;AACxE,MAAI,KAAK,CAAA;AACT,MAAI;AACF,SAAK,GAAG,qBAAW,KAAK,CAAC,KAAK,CAAC,CAAA;GAChC,CAAC,OAAO,CAAC,EAAE;AACV,WAAO,SAAS,CAAC,CAAC,CAAC,CAAA;GACpB;AACD,OAAK,CAAC,MAAM,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC,IAAI,CAAC,QAAQ,IAAI;AACxC,OAAG,CAAC,GAAG,CAAC,SAAS,CAAC,OAAO,CAAC,YAAY,EAAE,IAAI,CAAC,SAAS,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAA;GACnE,CAAC,CAAC,KAAK,CAAC,SAAS,CAAC,CAAA;CACpB,CAAC,CAAC;;AAEH,IAAI,CAAC,MAAM,CAAC,MAAM,EAChB,MAAM,CAAC,MAAM,CAAC,EAAE,EAAE,SAAS,CAAC,CAAA;;kBAEf,MAAM","file":"server.js","sourcesContent":["import fs from 'fs'\r\nimport path from 'path'\r\nimport http from 'http'\r\nimport url from 'url'\r\n\r\nimport WGraph from '../wgraph'\r\n\r\nlet server = http.createServer((req, res) => {\r\n  let sendError = err => {\r\n    console.error(err)\r\n    res.statusCode = 500;\r\n    res.end(err.message || err)\r\n  };\r\n  let srcDir = __dirname.replace(path.sep + 'lib' + path.sep, path.sep + 'src' + path.sep)\r\n  let indexHTML = String(fs.readFileSync(srcDir + '/index.html'))\r\n  let query = url.parse(req.url, true).query\r\n  if (!query.graph) return sendError('graph query parameter is required.')\r\n  let graph\r\n  try {\r\n    graph = new WGraph(query.graph)\r\n  } catch (e) {\r\n    return sendError(e)\r\n  }\r\n  graph.export(true, true).then(elements => {\r\n    res.end(indexHTML.replace('$graphJSON', JSON.stringify(elements)))\r\n  }).catch(sendError)\r\n});\r\n\r\nif (!module.parent)\r\n  server.listen(80, '0.0.0.0')\r\n\r\nexport default server\r\n"]}