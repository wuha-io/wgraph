{"version":3,"sources":["../src/leveldbprops.js"],"names":[],"mappings":";;;;;;;;;;;;AAGA,MAAM,iBAAiB,CAAC;;AAEvB,YAAW,CAAC,EAAE,EAAE;AAAE,MAAI,CAAC,EAAE,GAAG,EAAE,CAAA;EAAE;;AAEhC,IAAG,CAAC,SAAS,EAAE;AACd,SAAO,IAAI,eAAK,OAAO,CAAC,CAAC,OAAO,EAAE,MAAM,KAAK;AAC5C,OAAI,CAAC,EAAE,CAAC,GAAG,CAAC,SAAS,EAAE,CAAC,GAAG,EAAE,IAAI,KAAK;AACrC,QAAI,GAAG,EAAE;AACR,SAAI,GAAG,CAAC,OAAO,CAAC,OAAO,CAAC,2BAA2B,CAAC,KAAK,CAAC,CAAC,EAC1D,OAAO,MAAM,CAAC,GAAG,CAAC,CAAA;KACnB;AACD,QAAI,CAAC,IAAI,EAAE,IAAI,GAAG,EAAE,CAAA,KACf,IAAI,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,CAAA;AAC5B,WAAO,CAAC,IAAI,CAAC,CAAA;IACb,CAAC,CAAA;GACF,CAAC,CAAA;EACF;;AAED,MAAK,CAAC,SAAS,EAAE;AAAE,QAAM,IAAI,KAAK,CAAC,yBAAyB,CAAC,CAAA;EAAE;;AAE/D,IAAG,GAAG;AACL,MAAI,IAAI,GAAG,SAAS,CAAA;AACpB,MAAI,MAAM,GAAG,IAAI,CAAC,MAAM,CAAA;AACxB,MAAI,MAAM,GAAG,CAAC,EACb,MAAM,IAAI,KAAK,CAAC,mBAAmB,CAAC,CAAA;AACrC,MAAI,SAAS,GAAG,IAAI,CAAC,CAAC,CAAC,CAAA;AACvB,SAAO,IAAI,CAAC,CAAC,CAAC,CAAA;AACd,SAAO,IAAI,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC,IAAI,CAAC,IAAI,IAAI;AACvC,OAAI,MAAM,GAAG,EAAE,CAAA;AACf,OAAI,MAAM,GAAG,CAAC,EAAE;AACf,SAAK,IAAI,CAAC,IAAI,IAAI,EAAE,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAA;IACnD,MAAM;AACN,QAAI,OAAO,IAAI,CAAC,CAAC,CAAC,KAAK,QAAQ,EAC9B,IAAI,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,QAAQ,IAAI,MAAM,CAAC,QAAQ,CAAC,GAAG,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAA,KAC1D,IAAI,OAAO,IAAI,CAAC,CAAC,CAAC,KAAK,QAAQ,EACnC,MAAM,GAAG,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAA,KAEtB,MAAM,IAAI,KAAK,CAAC,8BAA8B,CAAC,CAAA;IAChD;AACD,UAAO,MAAM,CAAA;GACb,CAAC,CAAA;EACF;;AAED,IAAG,GAAG;AACL,MAAI,IAAI,GAAG,SAAS,CAAA;AACpB,MAAI,MAAM,GAAG,SAAS,CAAC,MAAM,CAAA;AAC7B,MAAI,MAAM,GAAG,CAAC,IAAI,MAAM,GAAG,CAAC,EAC3B,MAAM,IAAI,KAAK,CAAC,mBAAmB,CAAC,CAAA;AACrC,SAAO,IAAI,eAAK,OAAO,CAAC,CAAC,OAAO,EAAE,MAAM,KAAK;AAC5C,OAAI,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,IAAI;AAC9B,QAAI,MAAM,KAAK,CAAC,EAAE;AACjB,SAAI,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC,CAAC,CAAC,CAAA;KACvB,MAAM;AACN,SAAI,QAAQ,GAAG,EAAE,CAAA;AACjB,SAAI,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,EACzB,IAAI,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,QAAQ,IAAI;AAAE,cAAQ,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,GAAG,QAAQ,CAAC,CAAC,CAAC,CAAA;MAAE,CAAC,CAAA,KAChE,IAAI,OAAO,IAAI,CAAC,CAAC,CAAC,KAAK,QAAQ,EACnC,QAAQ,GAAG,IAAI,CAAC,CAAC,CAAC,CAAA,KAElB,OAAO,MAAM,CAAC,IAAI,KAAK,CAAC,8BAA8B,CAAC,CAAC,CAAC;AAC1D,UAAK,IAAI,QAAQ,IAAI,QAAQ,EAAE,IAAI,CAAC,QAAQ,CAAC,GAAG,QAAQ,CAAC,QAAQ,CAAC,CAAA;KAClE;AACD,QAAI,CAAC,EAAE,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,EAAE,GAAG,IAAI;AACjD,SAAI,GAAG,EAAE,OAAO,MAAM,CAAC,GAAG,CAAC,CAAA;AAC3B,YAAO,CAAC,IAAI,CAAC,CAAA;KACb,CAAC,CAAA;IACF,CAAC,CAAA;GACF,CAAC,CAAA;EACF;;AAED,IAAG,CAAC,SAAS,EAAE,KAAK,EAAE;AACrB,SAAO,IAAI,eAAK,OAAO,CAAC,CAAC,OAAO,EAAE,MAAM,KAAK;AAC5C,UAAO,IAAI,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC,IAAI,CAAC,IAAI,IAAI;AACvC,WAAO,IAAI,CAAC,KAAK,CAAC,CAAA;AAClB,QAAI,CAAC,EAAE,CAAC,GAAG,CAAC,SAAS,EAAE,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,EAAE,GAAG,IAAI;AACnD,SAAI,GAAG,EAAE,OAAO,MAAM,CAAC,GAAG,CAAC,CAAA;AAC3B,YAAO,CAAC,IAAI,CAAC,CAAA;KACb,CAAC,CAAA;IACF,CAAC,CAAA;GACF,CAAC,CAAA;EACF;;AAED,MAAK,CAAC,SAAS,EAAE;AAChB,SAAO,IAAI,eAAK,OAAO,CAAC,CAAC,OAAO,EAAE,MAAM,KAAK;AAC5C,OAAI,CAAC,EAAE,CAAC,GAAG,CAAC,SAAS,EAAE,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,EAAE,GAAG,IAAI;AACjD,QAAI,GAAG,EAAE,OAAO,MAAM,CAAC,GAAG,CAAC,CAAA;AAC3B,WAAO,CAAC,IAAI,CAAC,CAAA;IACb,CAAC,CAAA;GACF,CAAC,CAAA;EACF;;CAED;;kBAEc,iBAAiB","file":"leveldbprops.js","sourcesContent":["\r\nimport rsvp from 'rsvp'\r\n\r\nclass LevelDbProperties {\r\n\r\n\tconstructor(db) {\tthis.db = db\t}\r\n\r\n\tmap(namespace) {\r\n\t\treturn new rsvp.Promise((resolve, reject) => {\r\n\t\t\tthis.db.get(namespace, (err, data) => {\r\n\t\t\t\tif (err) {\r\n\t\t\t\t\tif (err.message.indexOf('Key not found in database') === -1)\r\n\t\t\t\t\t\treturn reject(err)\r\n\t\t\t\t}\r\n\t\t\t\tif (!data) data = {}\r\n\t\t\t\telse data = JSON.parse(data)\r\n\t\t\t\tresolve(data)\r\n\t\t\t})\r\n\t\t})\r\n\t}\r\n\r\n\tcount(namespace) { throw new Error('Not supported operation') }\r\n\r\n\tget() { \r\n\t\tlet args = arguments\r\n\t\tlet nbArgs = args.length\r\n\t\tif (nbArgs < 2)\r\n\t\t\tthrow new Error('Invalid arguments')\r\n\t\tlet namespace = args[0]\r\n\t\tdelete args[0]\r\n\t\treturn this.map(namespace).then(data => {\r\n\t\t\tlet result = {}\r\n\t\t\tif (nbArgs > 2) {\r\n\t\t\t\tfor (let i in args) result[args[i]] = data[args[i]]\r\n\t\t\t} else {\r\n\t\t\t\tif (typeof args[1] === 'object')\r\n\t\t\t\t\targs[1].forEach(property => result[property] = data[property])\r\n\t\t\t\telse if (typeof args[1] === 'string')\r\n\t\t\t\t\tresult = data[args[1]]\r\n\t\t\t\telse\r\n\t\t\t\t\tthrow new Error('Invalid properties arguments')\r\n\t\t\t}\r\n\t\t\treturn result\r\n\t\t})\r\n\t}\r\n\r\n\tset() {\r\n\t\tlet args = arguments\r\n\t\tlet nbArgs = arguments.length\r\n\t\tif (nbArgs < 2 && nbArgs > 3)\r\n\t\t\tthrow new Error('Invalid arguments')\r\n\t\treturn new rsvp.Promise((resolve, reject) => {\r\n\t\t\tthis.map(args[0]).then(data => {\r\n\t\t\t\tif (nbArgs === 3) {\r\n\t\t\t\t\tdata[args[1]] = args[2]\r\n\t\t\t\t} else {\r\n\t\t\t\t\tlet propsObj = {}\r\n\t\t\t\t\tif (Array.isArray(args[1]))\r\n\t\t\t\t\t\targs[1].forEach(property => { propsObj[property[0]] = property[1] })\r\n\t\t\t\t\telse if (typeof args[1] === 'object')\r\n\t\t\t\t\t\tpropsObj = args[1]\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\treturn reject(new Error('Invalid properties arguments'));\r\n\t\t\t\t\tfor (let property in propsObj) data[property] = propsObj[property]\r\n\t\t\t\t}\r\n\t\t\t\tthis.db.put(args[0], JSON.stringify(data), err => {\r\n\t\t\t\t\tif (err) return reject(err)\r\n\t\t\t\t\tresolve(this)\r\n\t\t\t\t})\r\n\t\t\t})\r\n\t\t})\t\r\n\t}\r\n\r\n\tdel(namespace, index) {\r\n\t\treturn new rsvp.Promise((resolve, reject) => {\r\n\t\t\treturn this.map(namespace).then(data => {\r\n\t\t\t\tdelete data[index]\r\n\t\t\t\tthis.db.put(namespace, JSON.stringify(data), err => {\r\n\t\t\t\t\tif (err) return reject(err)\r\n\t\t\t\t\tresolve(this)\r\n\t\t\t\t})\r\n\t\t\t})\r\n\t\t})\r\n\t}\r\n\r\n\tclear(namespace) {\r\n\t\treturn new rsvp.Promise((resolve, reject) => {\r\n\t\t\tthis.db.put(namespace, JSON.stringify({}), err => {\r\n\t\t\t\tif (err) return reject(err)\r\n\t\t\t\tresolve(this)\r\n\t\t\t})\r\n\t\t})\r\n\t}\r\n\r\n}\r\n\r\nexport default LevelDbProperties\r\n"]}