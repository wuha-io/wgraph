{"version":3,"sources":["../src/edge.js"],"names":[],"mappings":"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","file":"edge.js","sourcesContent":["\r\nimport util from 'util'\r\nimport rsvp from 'rsvp'\r\n\r\nimport NsProperties from './nsprops'\r\n\r\nclass Edge {\r\n\t\r\n\tconstructor(subject, predicate, object) {\r\n\t\tthis.subject = subject\r\n\t\tthis.predicate = predicate\r\n\t\tthis.object = object\r\n\t\tthis.graph = this.subject.graph\r\n\t\tthis.props = new NsProperties('__props:edge:' + this._relIndex(), this.graph.properties)\r\n\t\tthis.synchronized = false\r\n\t}\r\n\r\n\t_relIndex() { return this.subject.index + ':' + this.predicate + ':' + this.object.index }\r\n\r\n\ttriplet() { return this.graph.triplet(this.subject.index, this.predicate, this.object.index) }\r\n\r\n\tload() {\r\n\t\treturn new rsvp.Promise((resolve, reject) => {\r\n\t\t\tlet search = this.graph.triplet()\r\n\t\t\tsearch.filter = triplet => {\r\n\t\t\t\treturn triplet.subject === this.subject.index\r\n\t\t\t\t\t&& triplet.predicate === this.predicate\r\n\t\t\t\t\t&& triplet.object === this.object.index\r\n\t\t\t}\r\n\t\t\tthis.graph.graph.search(search, (err, triplets) => {\r\n\t\t\t\tif (err) return reject(err)\r\n\t\t\t\tif (!triplets.length) return resolve(this.triplet())\r\n\t\t\t\trsvp.all([\r\n\t\t\t\t\tthis.graph.node(this.subject.index).load(),\r\n\t\t\t\t\tthis.graph.node(this.object.index).load(),\r\n\t\t\t\t]).then(nodes => {\r\n\t\t\t\t\tthis.subject = nodes[0]\r\n\t\t\t\t\tthis.object = nodes[1]\r\n\t\t\t\t\tresolve(this)\r\n\t\t\t\t}).catch(reject)\r\n\t\t\t})\r\n\t\t})\r\n\t}\r\n\r\n\tsave() { return this.subject.save().then(() => { return this.load() }) }\r\n\r\n\tdel() {\r\n\t\treturn new rsvp.Promise((resolve, reject) => {\r\n\t\t\treturn this.props.del().then(() => {\r\n\t\t\t\tthis.graph.graph.del(this.triplet(), err => {\r\n\t\t\t\t\tif (err) return reject(err)\r\n\t\t\t\t\tresolve(this)\r\n\t\t\t\t})\r\n\t\t\t})\r\n\t\t})\r\n\t}\r\n\r\n\ttoString() {\r\n\t\treturn util.format(\r\n\t\t\t'Edge[%s %s %s]',\r\n\t\t\tthis.subject.index,\r\n\t\t\tthis.predicate,\r\n\t\t\tthis.object.index\r\n\t\t)\r\n\t}\r\n\r\n}\r\n\r\nexport default Edge\r\n"]}