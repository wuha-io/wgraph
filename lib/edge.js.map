{"version":3,"sources":["../src/edge.js"],"names":[],"mappings":"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","file":"edge.js","sourcesContent":["\r\nimport rsvp from 'rsvp'\r\n\r\nimport NsProperties from './nsprops'\r\nimport Relation from './relation'\r\n\r\nconst SELF_PREDICATE = '_self'\r\n\r\nclass Edge {\r\n\r\n\tconstructor(graph, index) {\r\n\t\tthis.graph = graph\r\n\t\tthis.index = index\r\n\t\tthis.props = new NsProperties('__props:edge:' + index, graph.properties)\r\n\t\tthis.relations = {}\r\n\t}\r\n\r\n\tload() {\r\n\t\treturn new rsvp.Promise((resolve, reject) => {\r\n\t\t\tthis.graph.graph.search(this.graph.triplet(this.index), (err, triplets) => {\r\n\t\t\t\tif (err) return reject(err)\r\n\t\t\t\ttriplets.forEach(triplet => {\r\n\t\t\t\t\tif (triplet.predicate === SELF_PREDICATE) return\r\n\t\t\t\t\tlet rel = new Relation(this, triplet.predicate, new Edge(this, triplet.object))\r\n\t\t\t\t\tthis.relations[triplet.predicate + ':' + triplet.object] = rel\r\n\t\t\t\t})\r\n\t\t\t\tresolve(this)\r\n\t\t\t})\r\n\t\t})\r\n\t}\r\n\r\n\t_triplets(includeSelf) {\r\n\t\tlet triplets = []\r\n\t\tif (includeSelf || !Object.keys(this.relations).length)\r\n\t\t\ttriplets.push(this.graph.triplet(this.index, SELF_PREDICATE, this.index))\r\n\t\tfor (let i in this.relations) {\r\n\t\t\tlet rel = this.relations[i]\r\n\t\t\ttriplets.push(this.graph.triplet(this.index, rel.predicate, rel.object.index))\r\n\t\t}\r\n\t\treturn triplets\r\n\t}\r\n\r\n\tsave() {\r\n\t\treturn new rsvp.Promise((resolve, reject) => {\r\n\t\t\tthis.graph.graph.put(this._triplets(), err => {\r\n\t\t\t\tif (err) return reject(err)\r\n\t\t\t\tresolve(this)\r\n\t\t\t})\r\n\t\t})\r\n\t}\r\n\r\n\tstandalone() { return !Object.keys(this.relations).length }\r\n\r\n\trel(predicate, edge, properties) {\r\n\t\tlet rel = new Relation(this, predicate, edge)\r\n\t\tthis.relations[predicate + ':' + edge.index] = rel\r\n\t\tif (properties) rel.props.set(properties)\r\n\t\treturn rel\r\n\t}\r\n\r\n\tdel() {\r\n\t\treturn new rsvp.Promise((resolve, reject) => {\r\n\t\t\treturn this.load().then(() => {\r\n\t\t\t\tlet q = []\r\n\t\t\t\tfor (let i in this.relations) q.push(this.relations[i].del())\r\n\t\t\t\tq.push(this.props.clear())\r\n\t\t\t\treturn rsvp.all(q).then(() => {\r\n\t\t\t\t\tlet tripletsTodel = this._triplets(true)\r\n\t\t\t\t\tthis.graph.graph.del(tripletsTodel, err => {\r\n\t\t\t\t\t\tif (err) return reject(err)\r\n\t\t\t\t\t\tresolve(tripletsTodel.length)\r\n\t\t\t\t\t})\r\n\t\t\t\t})\r\n\t\t\t})\r\n\t\t})\r\n\t}\r\n\r\n\ttoString() {\r\n\t\tlet str = 'Edge[' + this.index\r\n\t\tfor (let i in this.relations)\r\n\t\t\tstr += '\\n  ' + this.relations[i].toString()\r\n\t\tstr += '\\n]'\r\n\t\treturn str\r\n\t}\r\n\t\r\n}\r\n\r\nEdge.SELF_PREDICATE = SELF_PREDICATE\r\n\r\nexport default Edge\r\n"]}