{"version":3,"sources":["../src/edge.js"],"names":[],"mappings":"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","file":"edge.js","sourcesContent":["import util from 'util'\r\nimport rsvp from 'rsvp'\r\n\r\nimport NsProperties from './nsprops'\r\n\r\nclass Edge {\r\n\r\n  constructor(subject, predicate, object) {\r\n    this.subject = subject\r\n    this.predicate = predicate\r\n    this.object = object\r\n    this.graph = this.subject.graph\r\n    this.props = new NsProperties('__props:edge:' + this._relIndex(), this.graph.properties)\r\n  }\r\n\r\n  _relIndex() {\r\n    return this.subject.index + ':' + this.predicate + ':' + this.object.index\r\n  }\r\n\r\n  triplet() {\r\n    return this.graph.triplet(this.subject.index, this.predicate, this.object.index)\r\n  }\r\n\r\n  _syncProps() {\r\n    return this.props.map().then(map => {\r\n      this.propsMap = map;\r\n      return this;\r\n    })\r\n  }\r\n\r\n  load(syncProps, syncNodesProps) {\r\n    return new rsvp.Promise((resolve, reject) => {\r\n      let search = this.graph.triplet()\r\n      search.filter = triplet => {\r\n        return triplet.subject === this.subject.index\r\n          && triplet.predicate === this.predicate\r\n          && triplet.object === this.object.index\r\n      }\r\n      this.graph.graph.search(search, (err, triplets) => {\r\n        if (err) return reject(err)\r\n        if (!triplets.length) return resolve(this.triplet())\r\n        rsvp.all([\r\n          this.graph.node(this.subject.index).load(),\r\n          this.graph.node(this.object.index).load(),\r\n        ]).then(nodes => {\r\n          this.subject = nodes[0]\r\n          this.object = nodes[1]\r\n          let load = []\r\n          if (syncNodesProps) {\r\n            load.push(this.subject._syncProps())\r\n            load.push(this.object._syncProps())\r\n          }\r\n          if (syncProps) load.push(this._syncProps())\r\n          return rsvp.all(load).then(() => resolve(this))\r\n        }).catch(reject)\r\n      })\r\n    })\r\n  }\r\n\r\n  export() {\r\n    return {\r\n      subject: this.subject.index,\r\n      predicate: this.predicate,\r\n      object: this.object.index,\r\n      props: this.propsMap || {}\r\n    }\r\n  }\r\n\r\n  save() {\r\n    return this.subject.save().then(() => {\r\n      return this.load()\r\n    })\r\n  }\r\n\r\n  del() {\r\n    return new rsvp.Promise((resolve, reject) => {\r\n      return this.props.del().then(() => {\r\n        this.graph.graph.del(this.triplet(), err => {\r\n          if (err) return reject(err)\r\n          resolve(this)\r\n        })\r\n      })\r\n    })\r\n  }\r\n\r\n  toString() {\r\n    return util.format(\r\n      'Edge[%s %s %s]',\r\n      this.subject.index,\r\n      this.predicate,\r\n      this.object.index\r\n    )\r\n  }\r\n\r\n}\r\n\r\nexport default Edge\r\n"]}